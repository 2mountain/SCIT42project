<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- DAO인터페이스와 매핑 -->
<mapper namespace="net.softsociety.aimori.dao.AdministratorDAO">
	<select id="getMemberList" resultType="Member">
		SELECT *
		FROM Members
	</select>
	
	<update id="changeBlock" parameterType="member">
		UPDATE Members
		SET memberEnabled = #{memberEnabled}
		WHERE memberId = #{memberId}
	</update>

	<update id="changeRole" parameterType="member">
		UPDATE Members
		SET memberRoleName = #{memberRoleName}
		WHERE memberId = #{memberId}
	</update>
	
	<select id="getReportedBoard" resultType="ReportedBoard">
		SELECT r.memberId, r.boardNumber, r.questionNumber,
	        (SELECT boardCategory FROM board WHERE boardNumber = r.boardNumber) boardCategory,
	        (SELECT questionCategory FROM question WHERE questionNumber = r.questionNumber) questionCategory,
			(SELECT boardTitle FROM board WHERE boardNumber = r.boardNumber) boardTitle,
	        (SELECT questionTitle FROM question WHERE questionNumber = r.questionNumber) questionTitle,
			(SELECT boardInputDate FROM board WHERE boardNumber = r.boardNumber) boardInputdate,
	        (SELECT questionInputDate FROM question WHERE questionNumber = r.questionNumber) questionInputdate,
			r.reportCategory,
	        COUNT(r.boardNumber) AS reportBCount,
	        COUNT(r.questionNumber) AS reportQCount
		FROM reportData r
		GROUP BY r.boardNumber, r.questionNumber, r.reportCategory, r.memberId
		ORDER BY r.boardNumber, r.questionNumber, r.reportCategory
	</select>
</mapper>